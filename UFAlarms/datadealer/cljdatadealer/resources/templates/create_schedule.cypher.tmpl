MATCH (s:Site {siteid: "{{siteid}}"})
CREATE (s)-[:HAS]->(sch:Schedule {scheduleid: "{{scheduleid}}", name: "{{name}}", description: "{{description}}"})-[:BELONGS_TO]->(s)
WITH { props } AS props, sch
FOREACH (event IN props.events |
    CREATE (sch)-[:HAS]->(ce:CalendarEvents {date: event.date, days: event.days, id: event.id, photocell_enabled: event.photocell_enabled, photocell_highLevel: event.photocell_highLevel, photocell_lowLevel: event.photocell_lowLevel})-[:BELONGS_TO]->(sch)
    FOREACH (action IN event.actions |
        CREATE (ce)-[:HAS]->(a:Action {time: action.time, level: action.level, id: action.id})-[:BELONGS_TO]->(ce)
    )
)
CREATE (sch)-[:HAS]->(nnw:NoNetwork)-[:BELONGS_TO]->(sch)
SET nnw =
CASE props.network
WHEN null
THEN {}
ELSE props.network
END
SET sch.last_delivered = 0
